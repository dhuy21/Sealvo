<link rel="stylesheet" href="/css/common/header.css">
<header class="site-header">
  <div class="header-container">
    <div class="brand-container">
      <a href="../" class="brand-link">
        <div class="logo-wrapper">
          <img src="/images/logo.png" alt="Logo" class="logo-img">
          <div class="logo-glow"></div>
        </div>
        <h1 class="brand-text">SEALVO</h1>
      </a>
    </div>

    <button class="menu-toggle" aria-label="Toggle menu">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <div class="nav-container">
      <nav class="main-nav">
        <ul class="nav-list">
          <li class="nav-item {{#if isHome}}active{{/if}}">
            {{#if user}}
              <a href="../dashboard" class="nav-link">
                <i class="fas fa-home"></i>
                <span>Home</span>
              </a>
            {{else}}
              <a href="../login" class="nav-link">
                <i class="fas fa-home"></i>
                <span>Home</span>
              </a>
            {{/if}}
          </li>
          <li class="nav-item {{#if isFeedback}}active{{/if}}">
            <a href="/feedback" class="nav-link">
              <i class="fas fa-comments"></i>
              <span>Feedback</span>
            </a>
          </li>
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle">
              <i class="fas fa-th-large"></i>
              <span>Services</span>
            </a>
            <ul class="dropdown-menu">
              <li><a href="/myPackages" class="dropdown-item"><i class="fas fa-book"></i> My Packages</a></li>
            </ul>
          </li>
          <li class="nav-item {{#if isAbout}}active{{/if}}">
            <a href="../aboutme" class="nav-link">
              <i class="fas fa-user"></i>
              <span>About</span>
            </a>
          </li>
        </ul>
      </nav>

      <div class="user-controls">
        <div class="dark-mode-toggle" id="darkModeToggle" aria-label="Toggle dark mode">
          <i class="fas fa-moon"></i>
          <i class="fas fa-sun"></i>
        </div>
        {{#if user}}
          <div class="user-profile">
            <div class="user-avatar">
              {{#if user.avatar}}
                <img src="/images/avatars/{{user.avatar}}.png" alt="{{user.username}}'s avatar">
              {{else}}
                <span>{{firstLetter user.username}}</span>
              {{/if}}
            </div>
            <a href="../logout" class="logout-btn animated-logout-btn">
              <div class="sign">
                <svg viewBox="0 0 512 512">
                  <path d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"></path>
                </svg>
              </div>
              <div class="text">Sign Out</div>
            </a>
          </div>
        {{else}}
          <a href="../login" class="login-btn">
            <i class="fas fa-sign-in-alt"></i>
            <span>Sign In</span>
          </a>
        {{/if}}
      </div>
    </div>
  </div>
</header>

<script nonce="{{nonce}}">
  document.addEventListener('DOMContentLoaded', function() {
    // Toggle mobile menu
    const menuToggle = document.querySelector('.menu-toggle');
    const navContainer = document.querySelector('.nav-container');
    
    if (menuToggle) {
      menuToggle.addEventListener('click', function() {
        this.classList.toggle('active');
        navContainer.classList.toggle('active');
        document.body.classList.toggle('nav-open');
        
        // Close all dropdowns when toggling menu
        document.querySelectorAll('.dropdown').forEach(dropdown => {
          dropdown.classList.remove('open');
        });
        
        // Create/remove overlay when mobile menu is opened/closed
        if (navContainer.classList.contains('active')) {
          if (!document.querySelector('.mobile-menu-overlay')) {
            const overlay = document.createElement('div');
            overlay.className = 'mobile-menu-overlay';
            document.body.appendChild(overlay);
            
            // Add click event to close menu when overlay is clicked
            overlay.addEventListener('click', function() {
              menuToggle.classList.remove('active');
              navContainer.classList.remove('active');
              document.body.classList.remove('nav-open');
              document.body.removeChild(overlay);
            });
          }
        } else {
          const overlay = document.querySelector('.mobile-menu-overlay');
          if (overlay) {
            document.body.removeChild(overlay);
          }
        }
      });
    }
    
    // Handle window resize to reset mobile menu state on desktop view
    window.addEventListener('resize', function() {
      if (window.innerWidth > 1024 && document.body.classList.contains('nav-open')) {
        const overlay = document.querySelector('.mobile-menu-overlay');
        if (overlay) {
          document.body.removeChild(overlay);
        }
        menuToggle.classList.remove('active');
        navContainer.classList.remove('active');
        document.body.classList.remove('nav-open');
        
        // Reset all dropdowns when returning to desktop
        document.querySelectorAll('.dropdown').forEach(dropdown => {
          dropdown.classList.remove('open');
        });
      }
    });
    
    // Dropdown functionality
    const dropdowns = document.querySelectorAll('.dropdown');
    
    dropdowns.forEach(dropdown => {
      const toggle = dropdown.querySelector('.dropdown-toggle');
      
      toggle.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        dropdown.classList.toggle('open');
        
        // Close other open dropdowns
        dropdowns.forEach(other => {
          if (other !== dropdown && other.classList.contains('open')) {
            other.classList.remove('open');
          }
        });
      });
    });
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.dropdown')) {
        dropdowns.forEach(dropdown => {
          dropdown.classList.remove('open');
        });
      }
    });
  });
</script>