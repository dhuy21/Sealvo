
<link rel="stylesheet" href="/css/addWord.css">
<div class="vocabulary-container">
  <h1>Ajouter un nouveau mot</h1>

  <div class="import-section">
    <form action="/monVocabs/add/import?package={{package_id}}" method="POST" enctype="multipart/form-data" class="import-form">
      <div class="file-upload-container">
        <input type="file" id="vocab-file" name="file" accept=".xlsx,.xls,.csv,.pdf" class="file-input">
        <label for="vocab-file" class="file-label">
          <span class="file-icon">üìÑ</span>
          <span class="file-text">Choisir un fichier</span>
        </label>
        <span class="selected-file-name">Aucun fichier s√©lectionn√©</span>
      </div>
      <button type="submit" class="btn btn-primary import-btn">Importer du vocabulaire</button>
    </form>
    
    <div class="format-info">
      <p><strong>Format requis pour Excel/CSV:</strong> Les colonnes doivent √™tre dans l'ordre: Mot, Sujet, Type, Prononciation, Signification, Exemple, Synonymes, Antonymes, Grammaire, Niveau</p>
      <p><a href="/data/example-vocab.csv" download class="example-link">T√©l√©charger un fichier CSV d'exemple</a></p>
      <p><a href="/data/example-vocab.xlsx" download class="example-link">T√©l√©charger un fichier XLSX d'exemple</a></p>
      <details class="import-help">
        <summary>Aide pour l'importation</summary>
        <div class="help-content">
          <p>Pour que l'importation fonctionne correctement:</p>
          <ol>
            <li>Cr√©ez un fichier Excel avec les colonnes dans le bon ordre</li>
            <li>Assurez-vous que chaque ligne contient au moins: Mot, Sujet, Type, Signification et Exemple</li>
            <li>Pour le type, utilisez uniquement: noun, verb, adjective, adverb, ph.v, idiom, collocation</li>
            <li>Pour le niveau, utilisez <strong>uniquement les chiffres</strong> x, 0, 1, 2 ou v (pas de texte comme "Niveau 1")</li>
            <li>Limitez la taille du fichier √† moins de 5 Mo</li>
          </ol>
          <p>Si vous rencontrez des erreurs, v√©rifiez ces points et r√©essayez.</p>
        </div>
      </details>
    </div>
  </div>

  <div class="separator">
    <span>OU</span>
  </div>


  {{#if error}}
  <div class="alert alert-error">
    {{error}}
  </div>
  {{/if}}
  
  {{#if success}}
  <div class="alert alert-success">
    {{success}}
  </div>
  {{/if}}
  
    <!-- Formulaire pour ajouter plusieurs mots -->
    <form action="/monVocabs/add?package={{package_id}}" method="POST" class="word-form multiple-words-form">
      <input type="hidden" name="isMultipleWords" value="true">

      <div class="table-responsive">
        <table class="multi-word-table">
          <thead>
            <tr>
              <th>Mot</th>
              <th>Langue</th>
              <th>Sujet</th>
              <th>Type</th>
              <th>Prononciation</th>
              <th>Signification*</th>
              <th>Exemple*</th>
              <th>Synonymes</th>
              <th>Antonymes</th>
              <th>Grammaire</th>
              <th>Niveau*</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="word-rows">
            <tr class="word-row">
              <td><input type="text" name="words[]" required placeholder="Mot" class="form-control"></td>
              <td><input type="text" name="language_codes[]" required placeholder="Langue" class="form-control"></td>
              <td><input type="text" name="subjects[]" required placeholder="Sujet" class="form-control"></td>
              <td>
                <select name="types[]" required class="form-control">
                  <option value="" disabled selected>Type</option>
                  <option value="noun">Nom</option>
                  <option value="verb">Verbe</option>
                  <option value="adjective">Adjectif</option>
                  <option value="adverb">Adverbe</option>
                  <option value="ph.v">Ph.V</option>
                  <option value="idiom">Idiom</option>
                  <option value="collocation">Colloc</option>
                </select>
              </td>
              <td><input type="text" name="pronunciations[]" placeholder="Prononciation" class="form-control"></td>
              <td><input type="text" name="meanings[]" required placeholder="Signification" class="form-control"></td>
              <td><input type="text" name="examples[]" required placeholder="Exemple" class="form-control"></td>
              <td><input type="text" name="synonyms[]" placeholder="Synonymes" class="form-control"></td>
              <td><input type="text" name="antonyms[]" placeholder="Antonymes" class="form-control"></td>
              <td><input type="text" name="grammars[]" placeholder="Grammaire" class="form-control"></td>
              <td>
                <select name="levels[]" required class="form-control">
                  <option value="x">Niveau x</option>
                  <option value="0">Niveau 0</option>
                  <option value="1">Niveau 1</option>
                  <option value="2">Niveau 2</option>
                  <option value="v">Niveau v</option>
                </select>
              </td>
              <td>
                <button type="button" class="btn btn-danger remove-row"><i class="fas fa-trash"></i></button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="multiple-form-actions">
        <button type="button" id="add-row" class="btn btn-secondary">
          <i class="fas fa-plus"></i> Ajouter une ligne
        </button>
        <button type="submit" class="btn btn-primary">
          <span><i class="fas fa-save"></i>         Enregistrer tous les mots</span>
        </button>
      </div>
    </form>
  
  <div class="form-actions">
    <a href="/monVocabs?package={{package_id}}" class="btn btn-tertiary">Annuler</a>
  </div>
</div>

<script nonce="{{nonce}}">
  document.addEventListener('DOMContentLoaded', function() {
    // Fonction pour le fichier d'importation
    const fileInput = document.getElementById('vocab-file');
    const fileNameDisplay = document.querySelector('.selected-file-name');
    
    if (fileInput && fileNameDisplay) {
      fileInput.addEventListener('change', function() {
        if (this.files.length > 0) {
          fileNameDisplay.textContent = this.files[0].name;
        } else {
          fileNameDisplay.textContent = 'Aucun fichier s√©lectionn√©';
        }
      });
    }
    
    // Fonctions pour le formulaire multi-mots
    const addRowButton = document.getElementById('add-row');
    const wordRows = document.getElementById('word-rows');
    
    if (addRowButton && wordRows) {
      // Ajouter une nouvelle ligne
      addRowButton.addEventListener('click', function() {
        const newRow = document.createElement('tr');
        newRow.className = 'word-row';
        newRow.innerHTML = `
          <td><input type="text" name="words[]" required placeholder="Mot" class="form-control"></td>
          <td><input type="text" name="language_codes[]" required placeholder="Langue" class="form-control"></td>
          <td><input type="text" name="subjects[]" required placeholder="Sujet" class="form-control"></td>
          <td>
            <select name="types[]" required class="form-control">
              <option value="" disabled selected>Type</option>
              <option value="noun">Nom</option>
              <option value="verb">Verbe</option>
              <option value="adjective">Adjectif</option>
              <option value="adverb">Adverbe</option>
              <option value="ph.v">Ph.V</option>
              <option value="idiom">Idiom</option>
              <option value="collocation">Colloc</option>
            </select>
          </td>
          <td><input type="text" name="pronunciations[]" placeholder="Prononciation" class="form-control"></td>
          <td><input type="text" name="meanings[]" required placeholder="Signification" class="form-control"></td>
          <td><input type="text" name="examples[]" required placeholder="Exemple" class="form-control"></td>
          <td><input type="text" name="synonyms[]" placeholder="Synonymes" class="form-control"></td>
          <td><input type="text" name="antonyms[]" placeholder="Antonymes" class="form-control"></td>
          <td><input type="text" name="grammars[]" placeholder="Grammaire" class="form-control"></td>
          <td>
            <select name="levels[]" required class="form-control">
              <option value="x">Niveau x</option>
              <option value="0">Niveau 0</option>
              <option value="1">Niveau 1</option>
              <option value="2">Niveau 2</option>
            </select>
          </td>
          <td>
            <button type="button" class="btn btn-danger remove-row"><i class="fas fa-trash"></i></button>
          </td>
        `;
        wordRows.appendChild(newRow);
        
        // Ajouter l'√©couteur d'√©v√©nement pour supprimer la ligne
        setupRemoveRowListeners();
      });
      
      // Fonction pour configurer les √©couteurs de suppression de ligne
      function setupRemoveRowListeners() {
        document.querySelectorAll('.remove-row').forEach(button => {
          button.addEventListener('click', function() {
            // Ne pas permettre de supprimer la derni√®re ligne
            if (wordRows.querySelectorAll('.word-row').length > 1) {
              this.closest('.word-row').remove();
            } else {
              alert('Vous devez avoir au moins une ligne');
            }
          });
        });
      }
      
      // Configurer les √©couteurs au chargement initial
      setupRemoveRowListeners();
    }
  });
</script>
