<link rel="stylesheet" href="/css/myPackages.css">
<div class="packages-container">
  <!-- Floating decorative icons -->
  <i class="fas fa-box-open floating-icons float-icon-1"></i>
  <i class="fas fa-layer-group floating-icons float-icon-2"></i>
  <i class="fas fa-bookmark floating-icons float-icon-3"></i>
  
  <!-- Header -->
  <div class="packages-header fade-in">
    <h1><i class="fas fa-box-open"></i> Mes Packages</h1>
    <p class="header-subtitle">Organisez votre vocabulaire en packages thématiques</p>
  </div>

  <!-- Alerts -->
  {{#if error}}
  <div class="alert alert-error fade-in">
    <i class="fas fa-exclamation-triangle"></i>
    {{error}}
  </div>
  {{/if}}

  {{#if success}}
  <div class="alert alert-success fade-in">
    <i class="fas fa-check-circle"></i>
    {{success}}
  </div>
  {{/if}}

  <!-- Action Bar -->
  <div class="action-bar fade-in">
    <div class="action-stats">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-box"></i>
        </div>
        <div class="stat-content">
          <h3>{{packages.length}}</h3>
          <p>Packages</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
          <h3 id="public-count">0</h3>
          <p>Publics</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-lock"></i>
        </div>
        <div class="stat-content">
          <h3 id="private-count">0</h3>
          <p>Privés</p>
        </div>
      </div>
    </div>
    
  </div>

  <!-- Search Bar -->
  <div class="search-container fade-in">
    <div class="search-form">
      <div class="input-group">
        <input 
          type="search" 
          id="search-input"
          placeholder="Rechercher ..."
          class="search-input"
        >
        <button type="button" id="search-btn" class="search-btn">
          <i class="fas fa-search"></i>
        </button>
      </div>
    </div>
    <button class="continue-application" id="createPackageBtn">
      <div>
          <div class="pencil"></div>
          <div class="folder">
              <div class="top">
                  <svg viewBox="0 0 24 27">
                      <path d="M1,0 L23,0 C23.5522847,-1.01453063e-16 24,0.44771525 24,1 L24,8.17157288 C24,8.70200585 23.7892863,9.21071368 23.4142136,9.58578644 L20.5857864,12.4142136 C20.2107137,12.7892863 20,13.2979941 20,13.8284271 L20,26 C20,26.5522847 19.5522847,27 19,27 L1,27 C0.44771525,27 6.76353751e-17,26.5522847 0,26 L0,1 C-6.76353751e-17,0.44771525 0.44771525,1.01453063e-16 1,0 Z"></path>
                  </svg>
              </div>
              <div class="paper"></div>
          </div>
      </div>
      <span><div class="fas fa-plus"></div></span>
    </button>
  </div>

  <!-- Filter Options -->
  <div class="filter-container fade-in">
    <div class="filter-tabs">
      <button class="filter-tab active" data-filter="my-packages">
        <i class="fas fa-user"></i> Mes Packages
      </button>
      <button class="filter-tab" data-filter="all-public">
        <i class="fas fa-globe"></i> Packages Publics
      </button>
      <button class="filter-tab" data-filter="private">
        <i class="fas fa-lock"></i> Privés
      </button>
      <button class="filter-tab" data-filter="public">
        <i class="fas fa-share"></i> Mes Publics
      </button>
      <button class="filter-tab" data-filter="protected">
        <i class="fas fa-shield-alt"></i> Protégés
      </button>
    </div>
  </div>

  <!-- My Packages Grid -->
  <div class="packages-grid fade-in" id="packagesGrid">
    {{#if packages.length}}
      {{#each packages}}
        <div class="package-card {{#unless this.is_active}}inactive{{/unless}}" data-package-id="{{this.package_id}}" data-mode="{{this.mode}}">
          <div class="package-card-header">
            <div class="package-badges">
              <div class="package-mode-badge mode-{{this.mode}}">
                {{#if (eq this.mode 'private')}}
                  <i class="fas fa-lock"></i> Privé
                {{else if (eq this.mode 'public')}}
                  <i class="fas fa-globe"></i> Public
                {{else if (eq this.mode 'protected')}}
                  <i class="fas fa-shield-alt"></i> Protégé
                {{/if}}
              </div>
              <div class="status-badge {{#if this.is_active}}active{{else}}inactive{{/if}}">
                {{#if this.is_active}}Actif{{else}}Inactif{{/if}}
              </div>
            </div>
            <div class="package-actions">
              <button class="action-btn edit-btn" data-package-id="{{this.package_id}}" title="Modifier">
                <i class="fas fa-edit"></i>
              </button>
              <button class="action-btn delete-btn" data-package-id="{{this.package_id}}" title="Supprimer">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
          
          <div class="package-card-body">
            <div class="package-icon">
              <i class="fas fa-box-open"></i>
            </div>
            <h3 class="package-name">{{this.package_name}}</h3>
            <p class="package-description">{{this.package_description}}</p>
          </div>
          
          <div class="package-card-footer">
            <button class=" pushable view-package-btn" data-package-id="{{this.package_id}}">
              <span class="shadow"></span>
              <span class="edge"></span>
              <span class="front custom-front" > <i class="fas fa-eye"> </i> Voir</span>
            </button>
            <button class=" pushable learn-package-btn" data-package-id="{{this.package_id}}">
              <span class="shadow"></span>
              <span class="edge"></span>
              <span class="front"> <i class="fas fa-graduation-cap"></i> Apprendre</span>
            </button>
            <button class="pushable toggle-activation-btn {{#if this.is_active}}pushable-warning{{else}}pushable-success{{/if}}" data-package-id="{{this.package_id}}">
              <span class="shadow {{#if this.is_active}}shadow-warning{{else}}shadow-success{{/if}}"></span>
              <span class="edge {{#if this.is_active}}edge-warning{{else}}edge-success{{/if}}"></span>
              <span class="front {{#if this.is_active}}front-warning{{else}}front-success{{/if}}"> {{#if this.is_active}}
                <i class="fas fa-pause"></i> Désactiver
              {{else}}
                <i class="fas fa-play"></i> Activer
              {{/if}}
            </button>
          </div>
        </div>
      {{/each}}
    {{else}}
      <div class="empty-state">
        <div class="empty-icon">
          <i class="fas fa-box-open"></i>
        </div>
        <h3>Aucun package trouvé</h3>
        <p>Créez votre premier package pour organiser votre vocabulaire</p>
        <button class="btn btn-primary create-first-package-btn">
          <i class="fas fa-plus"></i> Créer mon premier package
        </button>
      </div>
    {{/if}}
  </div>

  <!-- Public Packages Grid -->
  <div class="packages-grid fade-in" id="publicPackagesGrid" style="display: none;">
    {{#if publicPackages.length}}
      {{#each publicPackages}}
        <div class="package-card public-package" data-package-id="{{this.package_id}}" data-mode="{{this.mode}}" data-owner="{{this.username}}">
          <div class="package-card-header">
            <div class="package-badges">
              <div class="package-mode-badge mode-{{this.mode}}">
                <i class="fas fa-globe"></i> Public
              </div>
              <div class="owner-badge">
                <i class="fas fa-user"></i> {{this.username}}
              </div>
            </div>
          </div>
          
          <div class="package-card-body">
            <div class="package-public-icon">
              <!-- From Uiverse.io by FWDJc -->
              <div class="eye-lid">
                <div class="eye">
                  <div class="cornea">
                    <div class="white-pupil"></div>
                  </div>
                </div>
              </div>
            </div>
            <h3 class="package-name">{{this.package_name}}</h3>
            <p class="package-description">{{this.package_description}}</p>
          </div>
          
          <div class="package-card-footer">
            <button class="pushable view-public-package-btn" data-package-id="{{this.package_id}}">
              <span class="shadow"></span>
              <span class="edge"></span>
              <span class="front"> <i class="fas fa-eye"> </i> Voir</span>
            </button>
            {{#unless (eq this.user_id ../user.id)}}
            <button class="pushable copy-package-btn" data-package-id="{{this.package_id}}">
              <span class="shadow-copy"></span>
              <span class="edge-copy"></span>
              <span class="front-copy"> <i class="fas fa-download"> </i> Copier</span>
            </button>
            {{/unless}}
          </div>
        </div>
      {{/each}}
    {{else}}
      <div class="empty-state">
        <div class="empty-icon">
          <i class="fas fa-globe"></i>
        </div>
        <h3>Aucun package public trouvé</h3>
        <p>Il n'y a actuellement aucun package public disponible</p>
      </div>
    {{/if}}
  </div>

  <!-- No Search Results -->
  <div class="no-results" id="noResults" style="display: none;">
    <div class="empty-icon">
      <i class="fas fa-search"></i>
    </div>
    <h3>Aucun résultat trouvé</h3>
    <p>Essayez de modifier votre recherche ou vos filtres</p>
  </div>
</div>

<!-- Create/Edit Package Modal -->
<div class="modal-overlay" id="packageModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modalTitle">
        <i class="fas fa-plus-circle"></i> Créer un package
      </h3>
      <button class="modal-close" id="closeModal">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <form id="packageForm">
      <div class="modal-body">
        <div class="form-group">
          <label for="packageName">
            <i class="fas fa-tag"></i> Nom du package
          </label>
          <input 
            type="text" 
            id="packageName" 
            name="package_name" 
            class="form-input"
            placeholder="Ex: Vocabulaire Business"
            required
          >
        </div>
        
        <div class="form-group">
          <label for="packageDescription">
            <i class="fas fa-align-left"></i> Description
          </label>
          <textarea 
            id="packageDescription" 
            name="package_description" 
            class="form-textarea"
            placeholder="Décrivez brièvement le contenu de ce package..."
            rows="4"
            required
          ></textarea>
        </div>
        
        <div class="form-group">
          <label for="packageMode">
            <i class="fas fa-cog"></i> Mode de visibilité
          </label>
          <select id="packageMode" name="mode" class="form-select">
            <option value="private">
              <i class="fas fa-lock"></i> Privé - Visible uniquement par vous
            </option>
            <option value="public">
              <i class="fas fa-globe"></i> Public - Visible par tous
            </option>
            <option value="protected">
              <i class="fas fa-shield-alt"></i> Protégé - Visible mais non modifiable
            </option>
          </select>
        </div>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="cancelBtn">
          <i class="fas fa-times"></i> Annuler
        </button>
        <button type="submit" class="btn btn-primary" id="submitBtn">
          <i class="fas fa-save"></i> Créer
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" id="deleteModal">
  <div class="modal-content modal-danger">
    <div class="modal-header">
      <h3>
        <i class="fas fa-exclamation-triangle"></i> Confirmer la suppression
      </h3>
      <button class="modal-close" id="closeDeleteModal">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <p>Êtes-vous sûr de vouloir supprimer ce package ?</p>
      <p class="warning-text">
        <i class="fas fa-warning"></i> Cette action est irréversible et supprimera tous les mots associés à ce package.
      </p>
    </div>
    
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" id="cancelDeleteBtn">
        <i class="fas fa-times"></i> Annuler
      </button>
      <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
        <i class="fas fa-trash"></i> Supprimer
      </button>
    </div>
  </div>
</div>

<script src="/js/myPackages.js"></script>
